{% extends 'base.html' %}

{% block title %}Bill History{% endblock %}

{% block content %}
    <section class="bill-history-section">
        <h2>Bill History</h2>
        {% if bills %}
            <table class="bill-table" aria-describedby="bill-history-desc">
                <caption id="bill-history-desc">A list of all past bills with their details.</caption>
                <thead>
                    <tr>
                        <th scope="col">Bill ID</th>
                        <th scope="col">Customer Name</th>
                        <th scope="col">Total Amount</th>
                        <th scope="col">Bill Date</th>
                        <th scope="col">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for bill in bills %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>{{ bill.customer_name }}</td>
                            <td>₹{{ bill.total_amount | round(2) }}</td>
                            <td>{{ bill.bill_date }}</td>
                            <td>
                                <button class="btn btn-details" type="button" data-toggle="collapse" data-target="#bill-details-{{ loop.index }}" aria-expanded="false" aria-controls="bill-details-{{ loop.index }}">
                                    View Items
                                </button>
                            </td>
                        </tr>
                        <tr class="bill-details-row">
                            <td colspan="5">
                                <div id="bill-details-{{ loop.index }}" class="collapse">
                                    {% if bill.items %}
                                        <table class="bill-items-table" aria-describedby="bill-items-desc-{{ loop.index }}">
                                            <caption id="bill-items-desc-{{ loop.index }}">Items in bill #{{ loop.index }}</caption>
                                            <thead>
                                                <tr>
                                                    <th scope="col">Product Name</th>
                                                    <th scope="col">Quantity</th>
                                                    <th scope="col">Price</th>
                                                    <th scope="col">Total</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for item in bill.items %}
                                                    <tr>
                                                        <td>{{ item.product_name }}</td>
                                                        <td>{{ item.quantity }}</td>
                                                        <td>₹{{ item.price | round(2) }}</td>
                                                        <td>₹{{ (item.price * item.quantity) | round(2) }}</td>
                                                    </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    {% else %}
                                        <p>No items found for this bill.</p>
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>No bills found.</p>
        {% endif %}
        <a href="{{ url_for('billing') }}" class="btn btn-secondary">Back to Billing</a>
    </section>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Add interactivity for collapse buttons if needed
            const buttons = document.querySelectorAll('[data-toggle="collapse"]');
            buttons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetId = button.getAttribute('data-target');
                    const target = document.querySelector(targetId);
                    const isExpanded = button.getAttribute('aria-expanded') === 'true';
                    button.setAttribute('aria-expanded', !isExpanded);
                    target.classList.toggle('collapse');
                });
            });
        });
    </script>
{% endblock %}